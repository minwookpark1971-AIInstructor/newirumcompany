# 권한 및 로컬 저장소 분석 보고서

## 📋 현재 구현 상태 분석

### 1. 로컬 저장소 저장 기능 ✅

#### 회원가입 시 저장
**위치**: `js/auth.js` - `handleSignupFallback()` 함수

```javascript
// 사용자 데이터 구조
const userData = {
    id: Date.now().toString(),
    name: formData.name || '',
    phone: formData.phone || '',
    email: formData.email,
    password: formData.password, // 비밀번호 저장
    registeredAt: new Date().toISOString(),
    status: 'active',
    authMethod: 'normal'
};

// localStorage에 저장
localStorage.setItem('users', JSON.stringify(users));
```

**저장 위치**: `localStorage['users']` (JSON 배열)

#### 로그인 시 저장
**위치**: `js/auth.js` - `handleLoginFallback()` 함수

```javascript
// 로그인 성공 시 저장
localStorage.setItem('isLoggedIn', 'true');
localStorage.setItem('userEmail', user.email);
localStorage.setItem('userName', user.name || '');
localStorage.setItem('userId', user.id || '');
```

**저장 항목**:
- `isLoggedIn`: 로그인 상태 ('true' 또는 없음)
- `userEmail`: 사용자 이메일
- `userName`: 사용자 이름
- `userId`: 사용자 ID

---

### 2. 헤더에 이메일 주소 표시 ✅

#### 구현 위치
**파일**: `js/components.js` - `generateHeader()` 함수

#### 로직
```javascript
const loggedIn = isLoggedIn();
const userEmail = getUserEmail();

if (loggedIn) {
    // 데스크톱: 이메일 + 로그아웃 버튼
    desktopActions = `
        <span style="margin-right: 1rem; color: var(--text); font-size: 0.875rem;">${userEmail}</span>
        <button id="logout-btn-header" class="btn btn-outline btn-sm">로그아웃</button>
    `;
    
    // 모바일: 이메일 + 로그아웃 버튼
    mobileActions = `
        <div style="padding: 0.75rem; color: var(--text); font-size: 0.875rem; text-align: center; margin-bottom: 0.5rem;">${userEmail}</div>
        <button id="logout-btn-mobile" class="btn btn-outline btn-sm btn-block">로그아웃</button>
    `;
} else {
    // 로그인 안 했을 때: 로그인/회원가입 버튼
    desktopActions = `
        <a href="${pathInfo.loginUrl}" class="btn btn-ghost btn-sm">로그인</a>
        <a href="${pathInfo.signupUrl}" class="btn btn-primary btn-sm">회원가입</a>
    `;
}
```

#### 헤더 업데이트
- 로그인 성공 시: `updateHeaderLoginStatus()` 호출
- 로그아웃 시: `updateHeaderLoginStatus()` 호출
- 페이지 로드 시: `loadComponents()` 호출하여 헤더 생성

**상태**: ✅ 정상 동작

---

### 3. 신청 메뉴 권한 분석

#### 강의 신청 (`html/apply.html`)

##### 권한 체크
**위치**: `html/apply.html` - `loadUserInfo()` 함수

```javascript
function loadUserInfo() {
    const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
    
    if (isLoggedIn) {
        // 로그인한 경우: 회원 정보 자동 입력 (readonly)
        const userEmail = localStorage.getItem('userEmail') || '';
        const userName = localStorage.getItem('userName') || '';
        
        $('#email').val(userEmail).prop('readonly', true);
        $('#name').val(userName).prop('readonly', true);
        
        // 전화번호는 users 배열에서 찾기
        const users = JSON.parse(localStorage.getItem('users') || '[]');
        const currentUser = users.find(u => u.email === userEmail);
        if (currentUser && currentUser.phone) {
            $('#phone').val(currentUser.phone).prop('readonly', true);
        }
    } else {
        // 로그인하지 않은 경우: 모든 필드 편집 가능
        $('#name, #email, #phone').prop('readonly', false);
    }
}
```

##### 신청 제출 권한
**위치**: `html/apply.html` - `initApplyForm()` 함수

```javascript
$('#apply-form').on('submit', function(e) {
    e.preventDefault();
    // 권한 체크 없음 - 누구나 신청 가능
    // localStorage에 저장
    localStorage.setItem('applications', JSON.stringify(applications));
});
```

**결론**:
- ✅ 로그인한 사용자: 회원 정보 자동 입력 (편의성 제공)
- ✅ 로그인하지 않은 사용자: 수동 입력 가능
- ⚠️ **권한 제한 없음**: 누구나 신청 가능 (로그인 필수 아님)

---

### 4. 문의하기 권한 분석

#### 문의 작성 권한
**위치**: `html/inquiry.html` - `checkLoginStatus()` 함수

```javascript
function checkLoginStatus() {
    const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
    if (isLoggedIn) {
        $('#login-banner').hide();
        $('#write-inquiry-section').show(); // 문의 작성 버튼 표시
    } else {
        $('#login-banner').show(); // 로그인 배너 표시
        $('#write-inquiry-section').hide();
    }
}
```

#### 문의 작성 시 권한 체크
**위치**: `html/inquiry.html` - 문의 작성 핸들러

```javascript
$('#write-inquiry-btn').on('click', function() {
    const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
    if (!isLoggedIn) {
        alert('문의를 작성하려면 로그인이 필요합니다.');
        window.location.href = 'auth/login.html';
        return;
    }
    // 모달 표시
});

$('#inquiry-form').on('submit', function(e) {
    e.preventDefault();
    
    const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
    if (!isLoggedIn) {
        alert('문의를 작성하려면 로그인이 필요합니다.');
        window.location.href = 'auth/login.html';
        return;
    }
    
    // 문의 저장
    localStorage.setItem('inquiries', JSON.stringify(allInquiries));
});
```

#### 문의 조회 권한
- ✅ **권한 제한 없음**: 누구나 문의 목록 조회 가능
- ✅ **권한 제한 없음**: 누구나 문의 상세 조회 가능

#### 답변 작성 권한
**위치**: `html/inquiry.html` - `showInquiryDetail()` 함수

```javascript
const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
const userEmail = localStorage.getItem('userEmail') || '';
const isAuthor = inquiry.authorEmail === userEmail;

// 본인이 작성한 문의에는 답변 불가
if (isLoggedIn && !isAuthor) {
    // 답변 작성 폼 표시
}
```

**결론**:
- ✅ 문의 작성: **로그인 필수**
- ✅ 문의 조회: **권한 제한 없음**
- ✅ 답변 작성: **로그인 필수** (본인 문의 제외)

---

## 🔍 발견된 문제점

### 1. `js/components.js`의 `isLoggedIn()` 함수 확인 필요

코드에서 함수가 비어있는 것처럼 보이지만, 실제로는 정상 동작하는 것으로 보입니다:

```javascript
function isLoggedIn() {
    return localStorage.getItem('isLoggedIn') === 'true';
}
```

**상태**: ✅ 정상 (코드 검색 결과 확인)

---

## 📊 권한 요약표

| 기능 | 로그인 필수 | 비고 |
|------|-----------|------|
| 회원가입 | ❌ | 누구나 가능 |
| 로그인 | ❌ | 누구나 가능 |
| 헤더 이메일 표시 | ✅ | 로그인 시에만 표시 |
| 강의 신청 | ❌ | 로그인 없이도 가능 (편의성 제공) |
| 상담 신청 | ❌ | 로그인 없이도 가능 (편의성 제공) |
| 강사 신청 | ❌ | 로그인 없이도 가능 (편의성 제공) |
| 문의 작성 | ✅ | 로그인 필수 |
| 문의 조회 | ❌ | 누구나 가능 |
| 답변 작성 | ✅ | 로그인 필수 (본인 문의 제외) |

---

## ✅ 권장 사항

### 1. 강의 신청 권한 제한 (선택사항)

현재는 로그인 없이도 신청 가능하지만, 필요시 로그인 필수로 변경 가능:

```javascript
// apply.html의 loadUserInfo() 함수 수정
function loadUserInfo() {
    const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
    
    if (!isLoggedIn) {
        alert('강의 신청을 하려면 로그인이 필요합니다.');
        window.location.href = 'auth/login.html';
        return;
    }
    
    // 로그인한 경우에만 정보 자동 입력
    // ...
}
```

### 2. 로컬 저장소 데이터 구조 확인

현재 저장되는 데이터:
- `users`: 회원 목록 (비밀번호 포함)
- `applications`: 신청 목록
- `inquiries`: 문의 목록
- `isLoggedIn`: 로그인 상태
- `userEmail`: 현재 로그인한 사용자 이메일
- `userName`: 현재 로그인한 사용자 이름
- `userId`: 현재 로그인한 사용자 ID

---

## 🧪 테스트 체크리스트

### 회원가입 및 로그인
- [ ] 회원가입 후 `localStorage['users']`에 저장되는지 확인
- [ ] 로그인 후 `localStorage['isLoggedIn']`이 'true'로 설정되는지 확인
- [ ] 로그인 후 헤더에 이메일 주소가 표시되는지 확인
- [ ] 로그아웃 후 헤더가 업데이트되는지 확인

### 신청 기능
- [ ] 로그인한 사용자가 강의 신청 시 회원 정보가 자동 입력되는지 확인
- [ ] 로그인하지 않은 사용자가 강의 신청 시 수동 입력이 가능한지 확인
- [ ] 신청 제출 후 `localStorage['applications']`에 저장되는지 확인

### 문의 기능
- [ ] 로그인하지 않은 사용자에게 로그인 배너가 표시되는지 확인
- [ ] 로그인한 사용자에게 "문의 작성하기" 버튼이 표시되는지 확인
- [ ] 문의 작성 시 `localStorage['inquiries']`에 저장되는지 확인
- [ ] 문의 조회는 로그인 없이도 가능한지 확인

---

## 📝 결론

### 정상 동작하는 기능 ✅
1. ✅ 로컬 저장소에 회원 정보 저장
2. ✅ 로그인 시 로컬 저장소에서 사용자 검색 및 인증
3. ✅ 헤더에 로그인한 사용자 이메일 표시
4. ✅ 신청 페이지에서 로그인한 사용자 정보 자동 입력
5. ✅ 문의하기에서 로그인 권한 체크

### 개선 가능한 부분
1. ⚠️ 강의 신청 권한 제한 (현재는 로그인 필수 아님)
2. ⚠️ 비밀번호 평문 저장 (보안상 해시화 권장)

**전체적으로 권한 체계는 정상적으로 구현되어 있으며, 로컬 저장소 기반 인증 시스템이 올바르게 동작하고 있습니다.**



